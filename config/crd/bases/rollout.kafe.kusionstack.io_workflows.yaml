
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.5.0
  creationTimestamp: null
  name: workflows.rollout.kafe.kusionstack.io
spec:
  group: rollout.kafe.kusionstack.io
  names:
    kind: Workflow
    listKind: WorkflowList
    plural: workflows
    singular: workflow
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Workflow is the Schema for the workflows API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: WorkflowSpec defines the desired state of Workflow
            properties:
              params:
                description: Params is the list of parameters for the rollout flow
                items:
                  description: Param defines the parameter of a task
                  properties:
                    name:
                      description: Name is the name of the parameter
                      type: string
                    value:
                      description: Value is the value of the parameter
                      properties:
                        arrayValue:
                          description: ArrayValue is the array value of the parameter
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                        boolValue:
                          description: BoolValue is the bool value of the parameter
                          type: boolean
                        intValue:
                          description: IntValue is the int value of the parameter
                          type: integer
                        objectValue:
                          additionalProperties:
                            type: string
                          description: ObjectValue is the object value of the parameter
                          type: object
                        stringValue:
                          description: StringValue is the string value of the parameter
                          type: string
                        type:
                          type: string
                      required:
                      - arrayValue
                      - boolValue
                      - intValue
                      - objectValue
                      - stringValue
                      - type
                      type: string
                      x-kubernetes-preserve-unknown-fields: true
                  required:
                  - name
                  - value
                  type: object
                type: array
              status:
                description: Status is used for pausing/canceling rollout flow
                type: string
              tasks:
                description: Tasks is the list of tasks in the rollout flow
                items:
                  description: WorkflowTask defines the task in the rollout flow
                  properties:
                    displayName:
                      description: DisplayName is the display name of the task, which will be used in the UI
                      type: string
                    labels:
                      additionalProperties:
                        type: string
                      description: Labels is the list of labels for the task
                      type: object
                    name:
                      description: Name is the name of the task It is used to identify the task in the rollout flow, which will be used with the runAfter field in the task to define the task dependency
                      type: string
                    runAfter:
                      description: RunAfter is the list of WorkflowTask names that the current task depends on
                      items:
                        type: string
                      type: array
                    taskSpec:
                      description: TaskSpec is the spec of the task
                      properties:
                        analysis:
                          description: Analysis is used to run analysis
                          type: object
                        custom:
                          description: Custom is used to run custom task defined by the user
                          properties:
                            executor:
                              description: Executor is the executor that will execute the custom task
                              properties:
                                endpoint:
                                  description: Endpoint is the endpoint of the executor server
                                  type: string
                              required:
                              - endpoint
                              type: object
                            name:
                              description: Name is the name of the custom task
                              type: string
                          required:
                          - executor
                          - name
                          type: object
                        echo:
                          description: Echo is used to print out the message, mainly for testing or demo purpose
                          properties:
                            message:
                              description: Message is the message to echo
                              type: string
                          required:
                          - message
                          type: object
                        params:
                          description: Params is a list of input parameters required to run the task.
                          items:
                            description: Param defines the parameter of a task
                            properties:
                              name:
                                description: Name is the name of the parameter
                                type: string
                              value:
                                description: Value is the value of the parameter
                                properties:
                                  arrayValue:
                                    description: ArrayValue is the array value of the parameter
                                    items:
                                      type: string
                                    type: array
                                    x-kubernetes-list-type: atomic
                                  boolValue:
                                    description: BoolValue is the bool value of the parameter
                                    type: boolean
                                  intValue:
                                    description: IntValue is the int value of the parameter
                                    type: integer
                                  objectValue:
                                    additionalProperties:
                                      type: string
                                    description: ObjectValue is the object value of the parameter
                                    type: object
                                  stringValue:
                                    description: StringValue is the string value of the parameter
                                    type: string
                                  type:
                                    type: string
                                required:
                                - arrayValue
                                - boolValue
                                - intValue
                                - objectValue
                                - stringValue
                                - type
                                type: string
                                x-kubernetes-preserve-unknown-fields: true
                            required:
                            - name
                            - value
                            type: object
                          type: array
                        resource:
                          description: Resource type task is used to manipulate k8s resources
                          properties:
                            action:
                              description: Action is the action to be performed on the resource
                              type: string
                            checker:
                              description: Checker is the checker to check if the task is successful
                              properties:
                                builtInChecker:
                                  description: BuiltInChecker is the built-in checker to check if the task is successful
                                  properties:
                                    params:
                                      description: Params is the parameters of the built-in checker
                                      items:
                                        description: Param defines the parameter of a task
                                        properties:
                                          name:
                                            description: Name is the name of the parameter
                                            type: string
                                          value:
                                            description: Value is the value of the parameter
                                            properties:
                                              arrayValue:
                                                description: ArrayValue is the array value of the parameter
                                                items:
                                                  type: string
                                                type: array
                                                x-kubernetes-list-type: atomic
                                              boolValue:
                                                description: BoolValue is the bool value of the parameter
                                                type: boolean
                                              intValue:
                                                description: IntValue is the int value of the parameter
                                                type: integer
                                              objectValue:
                                                additionalProperties:
                                                  type: string
                                                description: ObjectValue is the object value of the parameter
                                                type: object
                                              stringValue:
                                                description: StringValue is the string value of the parameter
                                                type: string
                                              type:
                                                type: string
                                            required:
                                            - arrayValue
                                            - boolValue
                                            - intValue
                                            - objectValue
                                            - stringValue
                                            - type
                                            type: string
                                            x-kubernetes-preserve-unknown-fields: true
                                        required:
                                        - name
                                        - value
                                        type: object
                                      type: array
                                    type:
                                      description: Type is the type of the built-in checker
                                      type: string
                                  required:
                                  - type
                                  type: object
                                failureCondition:
                                  description: FailureCondition is the condition to check if the task is failed
                                  type: string
                                successCondition:
                                  description: SuccessCondition is the condition to check if the task is successful
                                  type: string
                              type: object
                            manifest:
                              description: Manifest is the manifest of the resource
                              type: string
                            manifestFrom:
                              description: ManifestFrom is the source of the manifest
                              properties:
                                git:
                                  description: Git defines the git artifact details
                                  type: object
                                http:
                                  description: HTTP defines the http artifact details
                                  properties:
                                    body:
                                      description: Body is the body of the http request
                                      type: string
                                    headers:
                                      additionalProperties:
                                        type: string
                                      description: Headers are the headers of the http request
                                      type: object
                                    method:
                                      description: Method is the method of the http request
                                      type: string
                                    url:
                                      description: URL is the url of the artifact
                                      type: string
                                  required:
                                  - url
                                  type: object
                                name:
                                  description: Name is the name of the artifact
                                  type: string
                              type: object
                            mergeStrategy:
                              description: MergeStrategy is the strategy to merge a patch. Defaults to "strategic".
                              type: string
                          required:
                          - action
                          type: object
                        retryStrategy:
                          description: RetryStrategy defines the retry strategy for the task when it fails
                          properties:
                            backoff:
                              description: Backoff is the backoff strategy
                              type: object
                            limit:
                              description: Limit is the maximum number of retries
                              type: integer
                          required:
                          - limit
                          type: object
                        status:
                          description: Status is used to control the status of the task
                          type: string
                        suspend:
                          description: Suspend is used to pause the task
                          properties:
                            approved:
                              description: Approved indicates whether the task is approved to continue
                              type: boolean
                            duration:
                              description: Duration is the duration to suspend the workflow
                              format: int64
                              type: integer
                          type: object
                        workloadRelease:
                          description: WorkloadRelease is used to release the workload
                          properties:
                            partition:
                              anyOf:
                              - type: integer
                              - type: string
                              description: Partition is the partition of the workload release
                              x-kubernetes-int-or-string: true
                            readyCondition:
                              description: ReadyCondition is the condition to check if the task is successful
                              properties:
                                atLeastWaitingSeconds:
                                  description: AtLeastWaitingSeconds is the seconds to wait at least
                                  format: int32
                                  type: integer
                                failureThreshold:
                                  anyOf:
                                  - type: integer
                                  - type: string
                                  description: FailureThreshold indicates how many failed pods can be tolerated before marking the task as success
                                  x-kubernetes-int-or-string: true
                              type: object
                            workload:
                              description: Workload is the workload of the task
                              properties:
                                apiVersion:
                                  description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
                                  type: string
                                cluster:
                                  description: Cluster is the cluster of the task
                                  type: string
                                kind:
                                  description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                                  type: string
                                name:
                                  description: Name is the name of the workload
                                  type: string
                                namespace:
                                  description: Namespace is the namespace of the workload
                                  type: string
                              type: object
                          required:
                          - workload
                          type: object
                      type: object
                    when:
                      description: When is the condition to run the task
                      items:
                        type: object
                      type: array
                  required:
                  - name
                  type: object
                type: array
            type: object
          status:
            description: WorkflowStatus defines the observed state of Workflow
            properties:
              conditions:
                description: Conditions is a list of conditions the rollout flow is in
                items:
                  description: 'Condition defines the condition of a resource See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition transitioned from one status to another
                      format: date-time
                      type: string
                    message:
                      description: Message is the human-readable message indicating details about last transition
                      type: string
                    reason:
                      description: Reason is the reason for the condition's last transition
                      type: string
                    status:
                      description: Status is the status of the condition
                      type: string
                    type:
                      description: Type is the type of the condition
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              finishedAt:
                description: FinishedAt is the time when the rollout flow finished
                format: date-time
                type: string
              lastUpdatedAt:
                description: LastUpdatedAt is the time when the rollout flow was last updated
                format: date-time
                type: string
              message:
                description: Message indicates details about the current status
                type: string
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed for this Workflow. It corresponds to the Workflow's generation, which is updated on mutation by the API Server.
                format: int64
                type: integer
              phase:
                description: Phase is the rollout flow phase
                type: string
              skippedTasks:
                description: SkippedTasks is the list of tasks that are skipped
                items:
                  description: SkippedTask defines the skipped task
                  properties:
                    name:
                      description: Name is the name of the skipped task
                      type: string
                    reason:
                      description: Reason is the reason why the task is skipped
                      type: string
                  required:
                  - name
                  type: object
                type: array
              startedAt:
                description: StartedAt is the time when the rollout flow started
                format: date-time
                type: string
              tasks:
                description: Tasks is the list of tasks in the rollout flow
                items:
                  description: WorkflowTaskStatus defines the observed state of WorkflowTask
                  properties:
                    displayName:
                      description: DisplayName is the display name of the task, used in UI
                      type: string
                    finishedAt:
                      description: FinishedAt is the time when the task is finished
                      format: date-time
                      type: string
                    labels:
                      additionalProperties:
                        type: string
                      description: Labels is the labels of the task
                      type: object
                    name:
                      description: Name is the name of the task
                      type: string
                    startedAt:
                      description: StartedAt is the time when the task is started
                      format: date-time
                      type: string
                    successCondition:
                      description: SuccessCondition is the condition that indicates the task is succeeded
                      properties:
                        lastTransitionTime:
                          description: LastTransitionTime is the last time the condition transitioned from one status to another
                          format: date-time
                          type: string
                        message:
                          description: Message is the human-readable message indicating details about last transition
                          type: string
                        reason:
                          description: Reason is the reason for the condition's last transition
                          type: string
                        status:
                          description: Status is the status of the condition
                          type: string
                        type:
                          description: Type is the type of the condition
                          type: string
                      required:
                      - status
                      - type
                      type: object
                    workloadRelease:
                      description: WorkloadRelease is the release status of the workload
                      properties:
                        name:
                          description: Name is the name of the workload
                          type: string
                        observedGenerationUpdated:
                          description: ObservedGenerationUpdated indicates if the observedGeneration is updated to the latest generation
                          type: boolean
                        replicas:
                          description: Replicas is the number of replicas
                          format: int32
                          type: integer
                        updatedAvailableReplicas:
                          description: UpdatedAvailableReplicas is the number of updated available replicas
                          format: int32
                          type: integer
                        updatedReadyReplicas:
                          description: UpdatedReadyReplicas is the number of updated ready replicas
                          format: int32
                          type: integer
                        updatedReplicas:
                          description: UpdatedReplicas is the number of updated replicas
                          format: int32
                          type: integer
                      required:
                      - observedGenerationUpdated
                      - replicas
                      - updatedAvailableReplicas
                      - updatedReadyReplicas
                      - updatedReplicas
                      type: object
                  required:
                  - name
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
