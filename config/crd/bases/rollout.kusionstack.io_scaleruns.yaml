---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.15.0
  name: scaleruns.rollout.kusionstack.io
spec:
  group: rollout.kusionstack.io
  names:
    kind: ScaleRun
    listKind: ScaleRunList
    plural: scaleruns
    shortNames:
    - scr
    singular: scalerun
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.batchStatus.currentBatchIndex
      name: Batch Index
      type: string
    - jsonPath: .status.batchStatus.currentBatchState
      name: Batch State
      type: string
    - jsonPath: .status.error.code
      name: Error
      type: string
    - format: date-time
      jsonPath: .metadata.creationTimestamp
      name: AGE
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              batch:
                description: Scale Batch Strategy
                properties:
                  batches:
                    description: Batches define the order of phases to execute scale
                      in batch
                    items:
                      properties:
                        breakpoint:
                          description: If set to true, the scale will be paused before
                            the step starts.
                          type: boolean
                        properties:
                          additionalProperties:
                            type: string
                          description: Properties contains additional information
                            for step
                          type: object
                        targets:
                          description: desired target replicas
                          items:
                            description: ScaleRunStepTarget defines the target resource
                              of scale
                            properties:
                              cluster:
                                description: Cluster indicates the name of cluster
                                type: string
                              name:
                                description: Name is the resource name
                                type: string
                              replicas:
                                description: Replicas is the replicas of the scale
                                  task, which represents the replicas of the target
                                  resource
                                format: int32
                                type: integer
                            required:
                            - name
                            - replicas
                            type: object
                          type: array
                      required:
                      - targets
                      type: object
                    type: array
                type: object
              rollback:
                description: Rollback Batch Strategy
                properties:
                  batches:
                    description: Batches define the order of phases to execute scale
                      in batch
                    items:
                      properties:
                        breakpoint:
                          description: If set to true, the scale will be paused before
                            the step starts.
                          type: boolean
                        properties:
                          additionalProperties:
                            type: string
                          description: Properties contains additional information
                            for step
                          type: object
                        targets:
                          description: desired target replicas
                          items:
                            description: ScaleRunStepTarget defines the target resource
                              of scale
                            properties:
                              cluster:
                                description: Cluster indicates the name of cluster
                                type: string
                              name:
                                description: Name is the resource name
                                type: string
                              replicas:
                                description: Replicas is the replicas of the scale
                                  task, which represents the replicas of the target
                                  resource
                                format: int32
                                type: integer
                            required:
                            - name
                            - replicas
                            type: object
                          type: array
                      required:
                      - targets
                      type: object
                    type: array
                type: object
              targetType:
                description: TargetType defines the GroupVersionKind of target resource
                properties:
                  apiVersion:
                    description: |-
                      APIVersion is the group/version for the resource being referenced.
                      If APIVersion is not specified, the specified Kind must be in the core API group.
                      For any other third-party types, APIVersion is required.
                    type: string
                  kind:
                    description: Kind is the type of resource being referenced
                    type: string
                required:
                - kind
                type: object
              webhooks:
                description: Webhooks defines scale webhook configuration
                items:
                  properties:
                    clientConfig:
                      description: |-
                        ClientConfig defines how to communicate with the hook.
                        Required
                      properties:
                        caBundle:
                          description: |-
                            `caBundle` is a PEM encoded CA bundle which will be used to validate the webhook's server certificate.
                            If unspecified, system trust roots' CA on the node.
                          format: byte
                          type: string
                        periodSeconds:
                          default: 10
                          description: |-
                            How often (in seconds) to perform the probe.
                            Default to 10 seconds. Minimum value is 1.
                          format: int32
                          minimum: 1
                          type: integer
                        timeoutSeconds:
                          default: 10
                          description: |-
                            TimeoutSeconds specifies the timeout for this webhook. After the timeout passes,
                            the webhook call will be ignored or the API call will fail based on the
                            failure policy.
                          format: int32
                          type: integer
                        url:
                          description: |-
                            `url` gives the location of the webhook, in standard URL form
                            (`scheme://host:port/path`). Exactly one of `url` or `service`
                            must be specified.


                            The `host` should not refer to a service running in the cluster; use
                            the `service` field instead. The host might be resolved via external
                            DNS in some apiservers (e.g., `kube-apiserver` cannot resolve
                            in-cluster DNS as that would be a layering violation). `host` may
                            also be an IP address.


                            Please note that using `localhost` or `127.0.0.1` as a `host` is
                            risky unless you take great care to run this webhook on all hosts
                            which run an apiserver which might need to make calls to this
                            webhook. Such installs are likely to be non-portable, i.e., not easy
                            to turn up in a new cluster.


                            The scheme must be "https"; the URL must begin with "https://".


                            A path is optional, and if present may be any string permissible in
                            a URL. You may use the path to pass an arbitrary string to the
                            webhook, for example, a cluster identifier.


                            Attempting to use a user or basic auth e.g. "user:password@" is not
                            allowed. Fragments ("#...") and query parameters ("?...") are not
                            allowed, either.
                          type: string
                      type: object
                    failurePolicy:
                      description: |-
                        FailurePolicy defines how unrecognized errors from the admission endpoint are handled -
                        allowed values are Ignore or Fail. Defaults to Ignore.
                      type: string
                    failureThreshold:
                      default: 3
                      description: |-
                        Minimum consecutive failures for the probe to be considered failed after having succeeded.
                        Defaults to 3. Minimum value is 1.
                      format: int32
                      minimum: 1
                      type: integer
                    hookTypes:
                      description: |-
                        HookTypes defines when to communicate with the hook, specifies the types of events
                        that trigger the webhook.
                        Required
                      items:
                        description: Webhook type
                        type: string
                      type: array
                    name:
                      description: Name is the identity of webhook
                      type: string
                    properties:
                      additionalProperties:
                        type: string
                      description: Properties provide additional data for webhook.
                      type: object
                    provider:
                      description: |-
                        By default, rollout communicates with the webhook through the structure RolloutWebhookReview.
                        If provider is set, then the protocol of the interaction will be determined by the provider
                      type: string
                  type: object
                type: array
            type: object
          status:
            properties:
              batches:
                description: Batches describes the state of the active scale batch.
                properties:
                  currentBatchIndex:
                    description: CurrentBatchIndex defines the current batch index
                      of batch release progress.
                    format: int32
                    type: integer
                  currentBatchState:
                    description: CurrentBatchState indicates the current batch state.
                    type: string
                  records:
                    description: Records contains all batches status details.
                    items:
                      properties:
                        finishTime:
                          description: FinishTime is the time when the stage finished
                          format: date-time
                          type: string
                        index:
                          description: Index is the id of the batch
                          format: int32
                          type: integer
                        startTime:
                          description: StartTime is the time when the stage started
                          format: date-time
                          type: string
                        state:
                          description: State is Rollout step state
                          type: string
                        targets:
                          description: Targets contains release details for each workload
                          items:
                            properties:
                              availableReplicas:
                                description: AvailableReplicas is the available number
                                  of pods targeted by workload
                                format: int32
                                type: integer
                              cluster:
                                description: Cluster defines which cluster the workload
                                  is in.
                                type: string
                              currentReplicas:
                                description: CurrentReplicas is the number of current
                                  existed pods targeted by workload
                                format: int32
                                type: integer
                              name:
                                description: Name is the workload name
                                type: string
                              replicas:
                                description: Replicas is the desired number of pods
                                  targeted by workload
                                format: int32
                                type: integer
                              scaleFrom:
                                description: ScaleFrom is the number of replicas to
                                  scale from.
                                format: int32
                                type: integer
                              scaleTo:
                                description: |-
                                  ScaleTo is the number of replicas to scale to.
                                  It is the final number of replicas after scale operation.
                                format: int32
                                type: integer
                            required:
                            - availableReplicas
                            - currentReplicas
                            - replicas
                            - scaleFrom
                            - scaleTo
                            type: object
                          type: array
                        webhooks:
                          description: Webhooks contains webhook status
                          items:
                            properties:
                              code:
                                description: Code is a globally unique identifier
                                type: string
                              failureCount:
                                description: Failure count
                                format: int32
                                type: integer
                              finishTime:
                                description: FinishTime is the time when the hook
                                  finished
                                format: date-time
                                type: string
                              hookType:
                                description: Webhook Type
                                type: string
                              message:
                                description: A human-readable message indicating details
                                  about the transition.
                                type: string
                              name:
                                description: Webhook Name
                                type: string
                              reason:
                                description: A human-readable short word
                                type: string
                              startTime:
                                description: StartTime is the time when the hook started
                                format: date-time
                                type: string
                              state:
                                description: Current webhook worker state
                                type: string
                            type: object
                          type: array
                      type: object
                    type: array
                required:
                - currentBatchIndex
                type: object
              conditions:
                description: Conditions is the list of conditions
                items:
                  description: |-
                    Condition defines the condition of a resource
                    See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      format: date-time
                      type: string
                    lastUpdateTime:
                      description: The last time this condition was updated.
                      format: date-time
                      type: string
                    message:
                      description: A human-readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of the condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              error:
                description: Error indicates the error info of progressing.
                properties:
                  code:
                    description: Code is a globally unique identifier
                    type: string
                  message:
                    description: A human-readable message indicating details about
                      the transition.
                    type: string
                  reason:
                    description: A human-readable short word
                    type: string
                type: object
              lastUpdateTime:
                description: The last time this status was updated.
                format: date-time
                type: string
              observedGeneration:
                description: |-
                  ObservedGeneration is the most recent generation observed for this ScaleRun. It corresponds to the
                  ScaleRun's generation, which is updated on mutation by the API Server.
                format: int64
                type: integer
              phase:
                description: Phase indecates the current phase of scale
                type: string
              rollback:
                description: Rollback describes the state of the active rollback batch.
                properties:
                  currentBatchIndex:
                    description: CurrentBatchIndex defines the current batch index
                      of batch release progress.
                    format: int32
                    type: integer
                  currentBatchState:
                    description: CurrentBatchState indicates the current batch state.
                    type: string
                  records:
                    description: Records contains all batches status details.
                    items:
                      properties:
                        finishTime:
                          description: FinishTime is the time when the stage finished
                          format: date-time
                          type: string
                        index:
                          description: Index is the id of the batch
                          format: int32
                          type: integer
                        startTime:
                          description: StartTime is the time when the stage started
                          format: date-time
                          type: string
                        state:
                          description: State is Rollout step state
                          type: string
                        targets:
                          description: Targets contains release details for each workload
                          items:
                            properties:
                              availableReplicas:
                                description: AvailableReplicas is the available number
                                  of pods targeted by workload
                                format: int32
                                type: integer
                              cluster:
                                description: Cluster defines which cluster the workload
                                  is in.
                                type: string
                              currentReplicas:
                                description: CurrentReplicas is the number of current
                                  existed pods targeted by workload
                                format: int32
                                type: integer
                              name:
                                description: Name is the workload name
                                type: string
                              replicas:
                                description: Replicas is the desired number of pods
                                  targeted by workload
                                format: int32
                                type: integer
                              scaleFrom:
                                description: ScaleFrom is the number of replicas to
                                  scale from.
                                format: int32
                                type: integer
                              scaleTo:
                                description: |-
                                  ScaleTo is the number of replicas to scale to.
                                  It is the final number of replicas after scale operation.
                                format: int32
                                type: integer
                            required:
                            - availableReplicas
                            - currentReplicas
                            - replicas
                            - scaleFrom
                            - scaleTo
                            type: object
                          type: array
                        webhooks:
                          description: Webhooks contains webhook status
                          items:
                            properties:
                              code:
                                description: Code is a globally unique identifier
                                type: string
                              failureCount:
                                description: Failure count
                                format: int32
                                type: integer
                              finishTime:
                                description: FinishTime is the time when the hook
                                  finished
                                format: date-time
                                type: string
                              hookType:
                                description: Webhook Type
                                type: string
                              message:
                                description: A human-readable message indicating details
                                  about the transition.
                                type: string
                              name:
                                description: Webhook Name
                                type: string
                              reason:
                                description: A human-readable short word
                                type: string
                              startTime:
                                description: StartTime is the time when the hook started
                                format: date-time
                                type: string
                              state:
                                description: Current webhook worker state
                                type: string
                            type: object
                          type: array
                      type: object
                    type: array
                required:
                - currentBatchIndex
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
